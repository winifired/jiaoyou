{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/singleChat/singleChat.vue?c539","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/singleChat/singleChat.vue?3717","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/singleChat/singleChat.vue?f096","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/singleChat/singleChat.vue?cb9c","uni-app:///components/singleChat/singleChat.vue"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuH;AACvH;AAC8D;AACL;;;AAGzD;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,qFAAM;AACR,EAAE,8FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAomB,CAAgB,8nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACOxnB;AACA;AACA,uB;AACA;AACA,oBADA;AAEA,MAFA,kBAEA;AACA;AACA,aADA;AAEA,gBAFA;AAGA,sBAHA;;AAKA,GARA;AASA,QATA,oBASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aADA;AAEA,4CAJA;;AAMA,KARA;AASA;AACA;AACA;AACA,KAHA;AAIA;AACA,GA1BA;AA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAvCA;AAwCA;AACA,aADA,uBACA;AACA;AACA;AACA,eADA,mBACA,MADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBADA;AAEA,wBAFA;;AAIA;AACA,0BADA;;AAGA;AACA;AACA;AACA;AACA;AACA,iCADA;AAEA;AACA,iBADA,GACA,oCAHA;;AAKA,SAxBA;AAyBA,aAzBA,iBAyBA,GAzBA,EAyBA;AACA;AACA,SA3BA;;AA6BA;AACA,KAjCA;AAkCA,eAlCA,yBAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA,0CAFA;AAGA;AACA;AACA,aALA,MAKA;AACA;AACA;AACA,WAXA;;AAaA;AACA,SApBA;;;AAuBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAZA,MAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA,SACA,MADA,SACA,WADA,SACA,WADA,SACA,WADA;AAEA;AACA;AACA;AACA,WA3BA,MA2BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAFA,CADA;AAIA;AACA;AACA;AACA;AACA,iCADA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAFA;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAFA;AAGA;AACA,oBADA;;AAGA;AACA,KAlJA,EAxCA,E","file":"components/singleChat/singleChat.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./singleChat.vue?vue&type=template&id=171f9bc4&\"\nvar renderjs\nimport script from \"./singleChat.vue?vue&type=script&lang=js&\"\nexport * from \"./singleChat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/singleChat/singleChat.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./singleChat.vue?vue&type=template&id=171f9bc4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = JSON.stringify(_vm.arr)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./singleChat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./singleChat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t{{JSON.stringify(arr)}}\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tlet disp = require(\"../../utils/broadcast\");\r\n\tvar WebIM = require(\"../../utils/WebIM\")[\"default\"];\r\n\tlet isfirstTime = true;\r\n\texport default {\r\n\t\tname: \"singleChat\",\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tarr: [],\r\n\t\t\t\tmember: \"\",\r\n\t\t\t\tunReadSpotNum:0\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tlet me = this;\r\n\t\t\t//监听未读消息数\r\n\t\t\tdisp.on(\"em.unreadspot\", function(message) {\r\n\t\t\t\tme.getChatList();\r\n\t\t\t\tme.setData({\r\n\t\t\t\t\t// arr: me.getChatList(),\r\n\t\t\t\t\tunReadSpotNum: getApp().globalData.unReadMessageNum > 99 ?\r\n\t\t\t\t\t\t\"99+\" :\r\n\t\t\t\t\t\tgetApp().globalData.unReadMessageNum,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tdisp.on(\"em.contacts.remove\", function() {\r\n\t\t\t\tme.getChatList();\r\n\t\t\t\tme.getRoster();\r\n\t\t\t});\r\n\t\t\tthis.getRoster();\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tthis.getChatList();\r\n\t\t\t// this.setData({\r\n\t\t\t// \t//arr: this.getChatList(),\r\n\t\t\t// \tunReadSpotNum: getApp().globalData.unReadMessageNum > 99 ?\r\n\t\t\t// \t\t\"99+\" :\r\n\t\t\t// \t\tgetApp().globalData.unReadMessageNum,\r\n\t\t\t// \tmessageNum: getApp().globalData.saveFriendList.length,\r\n\t\t\t// \tunReadNoticeNum: getApp().globalData.saveGroupInvitedList.length,\r\n\t\t\t// \tunReadTotalNotNum: getApp().globalData.saveFriendList.length +\r\n\t\t\t// \t\tgetApp().globalData.saveGroupInvitedList.length,\r\n\t\t\t// });\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tgetRoster() {\r\n\t\t\t\tlet me = this;\r\n\t\t\t\tlet rosters = {\r\n\t\t\t\t\tsuccess(roster) {\r\n\t\t\t\t\t\tvar member = [];\r\n\t\t\t\t\t\tfor (let i = 0; i < roster.length; i++) {\r\n\t\t\t\t\t\t\tif (roster[i].subscription == \"both\") {\r\n\t\t\t\t\t\t\t\tmember.push(roster[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.setStorage({\r\n\t\t\t\t\t\t\tkey: \"member\",\r\n\t\t\t\t\t\t\tdata: member,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tme.setData({\r\n\t\t\t\t\t\t\tmember: member\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//if(!systemReady){\r\n\t\t\t\t\t\tdisp.fire(\"em.main.ready\");\r\n\t\t\t\t\t\t//systemReady = true;\r\n\t\t\t\t\t\t//}\r\n\t\t\t\t\t\tme.setData({\r\n\t\t\t\t\t\t\tarr: me.getChatList(),\r\n\t\t\t\t\t\t\tunReadSpotNum: getApp().globalData.unReadMessageNum > 99 ?\r\n\t\t\t\t\t\t\t\t\"99+\" : getApp().globalData.unReadMessageNum,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror(err) {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\tWebIM.conn.getRoster(rosters);\r\n\t\t\t},\r\n\t\t\tgetChatList() {\r\n\t\t\t\tvar myName = 'jiaoyou' + uni.getStorageSync(\"cityUserid\");\r\n\t\t\t\tvar array = [];\r\n\t\t\t\tconst me = this;\r\n\t\t\t\tuni.getStorageInfo({\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\tlet storageKeys = res.keys;\r\n\t\t\t\t\t\tlet newChatMsgKeys = [];\r\n\t\t\t\t\t\tlet historyChatMsgKeys = [];\r\n\t\t\t\t\t\tlet len = myName.length;\r\n\t\t\t\t\t\tstorageKeys.forEach((item) => {\r\n\t\t\t\t\t\t\tif (item.slice(-len) == myName && item.indexOf(\"rendered_\") == -1) {\r\n\t\t\t\t\t\t\t\tnewChatMsgKeys.push(item);\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\titem.slice(-len) == myName &&\r\n\t\t\t\t\t\t\t\titem.indexOf(\"rendered_\") > -1\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\thistoryChatMsgKeys.push(item);\r\n\t\t\t\t\t\t\t} else if (item === \"INFORM\") {\r\n\t\t\t\t\t\t\t\tnewChatMsgKeys.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcul.call(me, newChatMsgKeys, historyChatMsgKeys);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfunction cul(newChatMsgKeys, historyChatMsgKeys) {\r\n\t\t\t\t\tlet array = [];\r\n\t\t\t\t\tlet lastChatMsg;\r\n\r\n\t\t\t\t\tfor (let i = historyChatMsgKeys.length; i > 0, i--;) {\r\n\t\t\t\t\t\tlet index = newChatMsgKeys.indexOf(historyChatMsgKeys[i].slice(9));\r\n\t\t\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t\t\tlet newChatMsgs = uni.getStorageSync(newChatMsgKeys[index]) || [];\r\n\t\t\t\t\t\t\tif (newChatMsgKeys.includes()) {}\r\n\t\t\t\t\t\t\tif (newChatMsgs.length) {\r\n\t\t\t\t\t\t\t\tlastChatMsg = newChatMsgs[newChatMsgs.length - 1];\r\n\t\t\t\t\t\t\t\tlastChatMsg.unReadCount = newChatMsgs.length;\r\n\t\t\t\t\t\t\t\tif (lastChatMsg.unReadCount > 99) {\r\n\t\t\t\t\t\t\t\t\tlastChatMsg.unReadCount = \"99+\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(\" \")[0].split(\"-\");\r\n\t\t\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(\" \")[1].split(\":\");\r\n\t\t\t\t\t\t\t\tlet month = dateArr[2] < 10 ? \"0\" + dateArr[2] : dateArr[2];\r\n\t\t\t\t\t\t\t\tlastChatMsg.dateTimeNum = `${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`;\r\n\t\t\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}:${timeArr[1]}`;\r\n\t\t\t\t\t\t\t\tnewChatMsgKeys.splice(index, 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlet historyChatMsgs = uni.getStorageSync(historyChatMsgKeys[i]);\r\n\t\t\t\t\t\t\t\tif (historyChatMsgs.length) {\r\n\t\t\t\t\t\t\t\t\tlastChatMsg = historyChatMsgs[historyChatMsgs.length - 1];\r\n\t\t\t\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(\" \")[0].split(\"-\");\r\n\t\t\t\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(\" \")[1].split(\":\");\r\n\t\t\t\t\t\t\t\t\tlet month = dateArr[2] < 10 ? \"0\" + dateArr[2] : dateArr[2];\r\n\t\t\t\t\t\t\t\t\tlastChatMsg.dateTimeNum =\r\n\t\t\t\t\t\t\t\t\t\t`${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`;\r\n\t\t\t\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}:${timeArr[1]}`;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet historyChatMsgs = uni.getStorageSync(historyChatMsgKeys[i]);\r\n\t\t\t\t\t\t\tif (historyChatMsgs.length) {\r\n\t\t\t\t\t\t\t\tlastChatMsg = historyChatMsgs[historyChatMsgs.length - 1];\r\n\t\t\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(\" \")[0].split(\"-\");\r\n\t\t\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(\" \")[1].split(\":\");\r\n\t\t\t\t\t\t\t\tlet month = dateArr[2] < 10 ? \"0\" + dateArr[2] : dateArr[2];\r\n\t\t\t\t\t\t\t\tlastChatMsg.dateTimeNum = `${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`;\r\n\t\t\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}:${timeArr[1]}`;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tlastChatMsg &&\r\n\t\t\t\t\t\t\t(lastChatMsg.chatType == \"groupchat\" ||\r\n\t\t\t\t\t\t\t\tlastChatMsg.chatType == \"chatRoom\")\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tlastChatMsg.groupName = me.groupName[lastChatMsg.info.to];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlastChatMsg && lastChatMsg.username != myName &&\r\n\t\t\t\t\t\t\tarray.push(lastChatMsg);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let i = newChatMsgKeys.length; i > 0, i--;) {\r\n\t\t\t\t\t\tlet newChatMsgs = uni.getStorageSync(newChatMsgKeys[i]) || [];\r\n\t\t\t\t\t\tif (newChatMsgs.length) {\r\n\t\t\t\t\t\t\tlastChatMsg = newChatMsgs[newChatMsgs.length - 1];\r\n\t\t\t\t\t\t\tlastChatMsg.unReadCount = newChatMsgs.length;\r\n\t\t\t\t\t\t\tif (lastChatMsg.unReadCount > 99) {\r\n\t\t\t\t\t\t\t\tlastChatMsg.unReadCount = \"99+\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet dateArr = lastChatMsg.time.split(\" \")[0].split(\"-\");\r\n\t\t\t\t\t\t\tlet timeArr = lastChatMsg.time.split(\" \")[1].split(\":\");\r\n\t\t\t\t\t\t\tlet month = dateArr[2] < 10 ? \"0\" + dateArr[2] : dateArr[2];\r\n\t\t\t\t\t\t\tlastChatMsg.dateTimeNum = `${dateArr[1]}${month}${timeArr[0]}${timeArr[1]}${timeArr[2]}`;\r\n\t\t\t\t\t\t\tlastChatMsg.time = `${dateArr[1]}月${dateArr[2]}日 ${timeArr[0]}:${timeArr[1]}`;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tlastChatMsg.chatType == \"groupchat\" ||\r\n\t\t\t\t\t\t\t\tlastChatMsg.chatType == \"chatRoom\"\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tlastChatMsg.groupName = me.groupName[lastChatMsg.info.to];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlastChatMsg.username != myName && array.push(lastChatMsg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tarray.sort((a, b) => {\r\n\t\t\t\t\t\treturn b.dateTimeNum - a.dateTimeNum;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tarr: array,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\r\n</style>\n"],"sourceRoot":""}