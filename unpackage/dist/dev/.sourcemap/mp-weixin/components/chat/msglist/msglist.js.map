{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?c1da","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?a757","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?6b51","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?8425","uni-app:///components/chat/msglist/msglist.vue","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?e636","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/msglist/msglist.vue?8abe"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACa;;;AAGnE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAimB,CAAgB,2nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACoErnB;AACA;AACA;AACA,6BADA;AAEA,uBAFA;;AAIA;AACA;AACA;AACA,mB;;;AAGA;AACA,MADA,kBACA;AACA;AACA,8BADA;AAEA,gBAFA;AAGA,iBAHA;AAIA,2BAJA;AAKA,kBALA;AAMA,oBANA;AAOA,oBAPA;;AASA,GAXA;;AAaA;AACA,sBADA,EAbA;;AAgBA;AACA;AACA,kBADA;AAEA,+CAFA,EADA,EAhBA;;;AAsBA;AACA,SAvBA,qBAuBA,EAvBA;;AAyBA,aAzBA,yBAyBA;AACA;AACA;AACA;AACA,GA7BA;;AA+BA,OA/BA,mBA+BA,EA/BA;;AAiCA,WAjCA,uBAiCA;AACA;AACA;AACA,GApCA;;AAsCA,SAtCA,mBAsCA,KAtCA,EAsCA;AACA;AACA;AACA;AACA,mBADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UADA,GACA;AACA;AACA;AACA;AACA,4BADA;;AAGA;AACA,OATA;AAUA;AACA;AACA;AACA;;AAEA;AACA,KAvBA;AAwBA;AACA,GA7EA;;AA+EA;AACA,gBADA,0BACA;AACA;AACA,gCADA;;AAGA,KALA;AAMA,WANA,mBAMA,aANA,EAMA,IANA,EAMA,UANA,EAMA,OANA,EAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCATA,CASA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAPA,MAOA;AACA;AACA;AACA;AACA;AACA,KA7BA;AA8BA,eA9BA,yBA8BA;AACA;AACA,+BADA;;AAGA,KAlCA;;AAoCA,SApCA,mBAoCA;AACA;AACA,qBADA;;AAGA,KAxCA;;AA0CA,gBA1CA,wBA0CA,KA1CA,EA0CA;AACA;AACA;AACA,mBADA,CACA;AADA;;AAIA,KAhDA;;AAkDA,iBAlDA,2BAkDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kDADA;AAEA,2DAFA;;AAIA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAzEA;;AA2EA,aA3EA,qBA2EA,aA3EA,EA2EA,IA3EA,EA2EA,UA3EA,EA2EA,UA3EA,EA2EA,KA3EA,EA2EA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,kDADA;AAEA;AACA,iEAHA;;AAKA,OANA,MAMA;AACA;AACA,6CADA;AAEA;AACA,iEAHA;;AAKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAJA;AAKA,OANA;AAOA;AACA;AACA;AACA;AACA;AACA,yBADA;AAEA,uBAFA;AAGA;AACA;AACA,WALA;;AAOA,OARA,EAQA,GARA;;AAUA;AACA;AACA;AACA;AACA;AACA,KA7HA;;AA+HA,cA/HA,sBA+HA,UA/HA,EA+HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA;;AAGA;AACA,OARA;;AAUA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAnJA;;AAqJA,YArJA,oBAqJA,KArJA,EAqJA;AACA;AACA,sCADA;AAEA,oDAFA,EAEA;AACA;AACA;AACA,KA3JA;AA4JA,iBA5JA,yBA4JA,IA5JA,EA4JA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAHA,EAGA,IAHA,CAGA,GAHA;AAIA,KAzKA,EA/EA,E;;;;;;;;;;;;;AChFA;AAAA;AAAA;AAAA;AAAm3B,CAAgB,o3BAAG,EAAC,C;;;;;;;;;;;ACAv4B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/chat/msglist/msglist.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./msglist.vue?vue&type=template&id=5b766f9a&\"\nvar renderjs\nimport script from \"./msglist.vue?vue&type=script&lang=js&\"\nexport * from \"./msglist.vue?vue&type=script&lang=js&\"\nimport style0 from \"./msglist.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/chat/msglist/msglist.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=template&id=5b766f9a&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.chatMsg, function(item, __i0__) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 =\n      item.msg.type == \"custom\" && item.msg.ext.inviteCode != 0\n        ? _vm.formatMinTime(item.msg.ext.inviteCode)\n        : null\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view scroll-y=\"true\" :class=\"view + ' wrap ' + (isIPX?'scroll_view_X': '')\" @tap=\"onTap\" upper-threshold=\"-50\"\r\n\t\t:scroll-into-view=\"toView\">\r\n\t\t<view class=\"message\" v-for=\"item in chatMsg\" :key=\"item.mid\" :id=\"item.mid\">\r\n\t\t\t<!-- <view class=\"time\">\r\n\t\t\t\t<text class=\"time-text\">{{ item.time }}</text>\r\n\t\t\t</view> -->\r\n\t\t\t<view class=\"main\" :class=\"item.style\">\r\n\t\t\t\t<view class=\"user\">\r\n\t\t\t\t\t<!-- yourname：就是消息的 from -->\r\n\t\t\t\t\t<text class=\"user-text\">{{ item.time}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<image class=\"avatar\" :src=\"username.my_nick\" v-if=\"item.style == 'self'\" />\r\n\t\t\t\t<image class=\"avatar\" :src=\"username.your_nick\" v-else />\r\n\t\t\t\t<view class=\"msg\">\r\n\t\t\t\t\t<image class=\"err\" :class=\"(item.style == 'self' && item.isFail) ?  'show' : 'hide'\"\r\n\t\t\t\t\t\tsrc=\"/static/images/msgerr.png\" />\r\n\r\n\t\t\t\t\t<image v-if=\"item.style == 'self'\" src=\"/static/images/poprightarrow2x.png\"\r\n\t\t\t\t\t\tclass=\"msg_poprightarrow\" />\r\n\t\t\t\t\t<image v-if=\"item.style == ''\" src=\"/static/images/popleftarrow2x.png\" class=\"msg_popleftarrow\" />\r\n\t\t\t\t\t<view v-if=\"item.msg.type == 'img' || item.msg.type == 'video'\">\r\n\t\t\t\t\t\t<image v-if=\"item.msg.type == 'img'\" class=\"avatar\" :src=\"item.msg.data\"\r\n\t\t\t\t\t\t\tstyle=\"width:90px; height:120px; margin:2px auto;\" mode=\"aspectFit\" @tap=\"previewImage\"\r\n\t\t\t\t\t\t\t:data-url=\"item.msg.data\" />\r\n\t\t\t\t\t\t<!-- <video v-if=\"item.msg.type == 'video'\" :src=\"item.msg.data\" controls style=\"width:300rpx;\"/> -->\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<audio-msg v-if=\"item.msg.type == 'audio'\" :msg=\"item\"></audio-msg>\r\n\t\t\t\t\t<view v-else-if=\"item.msg.type == 'txt' || item.msg.type == 'emoji'\">\r\n\t\t\t\t\t\t<view class=\"template\" v-for=\"(d_item, d_index) in item.msg.data\" :key=\"d_index\">\r\n\t\t\t\t\t\t\t<text :data-msg=\"item\" @tap=\"clickMsg\" v-if=\"d_item.type == 'txt'\" class=\"msg-text\"\r\n\t\t\t\t\t\t\t\tstyle=\"float:left;\" selectable=\"true\">{{ d_item.data }}</text>\r\n\r\n\t\t\t\t\t\t\t<image v-if=\"d_item.type == 'emoji'\" class=\"avatar\" :src=\"'/static/faces/' + d_item.data\"\r\n\t\t\t\t\t\t\t\tstyle=\"width:25px; height:25px; margin:0 0 2px 0; float:left;\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"flex\" :class=\"item.style != 'self'?'flex-direction':''\" v-if=\"item.msg.type=='custom'\">\r\n\t\t\t\t\t\t<text class=\"msg-text\"\r\n\t\t\t\t\t\t\tv-if=\"item.msg.ext.inviteCode==0\">已取消</text>\r\n\t\t\t\t\t\t<text class=\"msg-text\"\r\n\t\t\t\t\t\t\tv-if=\"item.msg.ext.inviteCode!=0\">{{'通话时长：'+formatMinTime(item.msg.ext.inviteCode)}}</text>\r\n\t\t\t\t\t\t<block\r\n\t\t\t\t\t\t\tv-if=\"item.msg.ext.extmsg == 'inviteVideoAction'\">\r\n\t\t\t\t\t\t\t<block v-if=\"item.msg.ext.extype == 2\">\r\n\t\t\t\t\t\t\t\t<image src=\"/static/icon/videoCallW.png\" mode=\"\" class=\"icon38 callIcon\"\r\n\t\t\t\t\t\t\t\t\tv-if=\"item.style == 'self'\" :class=\"item.style == 'self'?'rotate':''\"></image>\r\n\t\t\t\t\t\t\t\t<image src=\"/static/icon/videoCallB.png\" mode=\"\" class=\"icon38 callIcon\"\r\n\t\t\t\t\t\t\t\t\tv-if=\"item.style != 'self'\">\r\n\t\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t<block v-if=\"item.msg.ext.extype == 1\">\r\n\t\t\t\t\t\t\t\t<image src=\"/static/icon/voiceCallW.png\" mode=\"\" class=\"icon38 callIcon\"\r\n\t\t\t\t\t\t\t\t\tv-if=\"item.style == 'self'\"></image>\r\n\t\t\t\t\t\t\t\t<image src=\"/static/icon/voiceCallB.png\" mode=\"\" class=\"icon38 callIcon\"\r\n\t\t\t\t\t\t\t\t\tv-if=\"item.style != 'self'\"></image>\r\n\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t</block>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n\t<!-- <view style=\"height: 1px;\"></view> -->\r\n</template>\r\n\r\n\r\n<script>\r\n\tlet msgStorage = require(\"../msgstorage\");\r\n\tlet disp = require(\"../../../utils/broadcast\");\r\n\tlet LIST_STATUS = {\r\n\t\tSHORT: \"scroll_view_change\",\r\n\t\tNORMAL: \"scroll_view\"\r\n\t};\r\n\tlet page = 0;\r\n\tlet Index = 0;\r\n\tlet curMsgMid = '';\r\n\tlet isFail = false;\r\n\timport audioMsg from \"./type/audio/audio\";\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tview: LIST_STATUS.NORMAL,\r\n\t\t\t\ttoView: \"\",\r\n\t\t\t\tchatMsg: [],\r\n\t\t\t\t__visibility__: false,\r\n\t\t\t\tisIPX: false,\r\n\t\t\t\tusernick: null,\r\n\t\t\t\tyournick: null\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\tcomponents: {\r\n\t\t\taudioMsg\r\n\t\t},\r\n\t\tprops: {\r\n\t\t\tusername: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// lifetimes\r\n\t\tcreated() {},\r\n\r\n\t\tbeforeMount() {\r\n\t\t\tthis.__visibility__ = true;\r\n\t\t\tpage = 0;\r\n\t\t\tIndex = 0;\r\n\t\t},\r\n\r\n\t\tmoved() {},\r\n\r\n\t\tdestroyed() {\r\n\t\t\tthis.__visibility__ = false;\r\n\t\t\t// msgStorage.off(\"newChatMsg\", this.dispMsg)\r\n\t\t},\r\n\r\n\t\tmounted(event) {\r\n\t\t\tlet me = this;\r\n\t\t\tif (getApp().globalData.isIPX) {\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tisIPX: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.username = uni.username;\r\n\t\t\tlet username = this.username;\r\n\t\t\tlet myUsername = 'jiaoyou' + uni.getStorageSync('cityUserid');\r\n\t\t\tlet sessionKey = username.groupId ? username.groupId + myUsername : username.your + myUsername;\r\n\t\t\tlet chatMsg = uni.getStorageSync(sessionKey) || [];\r\n\t\t\tthis.renderMsg(null, null, chatMsg, sessionKey);\r\n\t\t\tuni.setStorageSync(sessionKey, null);\r\n\t\t\tdisp.on('em.error.sendMsgErr', function(err) {\r\n\t\t\t\t// curMsgMid = err.data.mid;\r\n\t\t\t\tisFail = true;\r\n\t\t\t\t// return;\r\n\t\t\t\tconsole.log('发送失败了');\r\n\t\t\t\treturn;\r\n\t\t\t\tlet msgList = me.chatMsg;\r\n\t\t\t\tmsgList.map(item => {\r\n\t\t\t\t\tif (item.mid.substring(item.mid.length - 10) == curMsgMid.substring(curMsgMid.length -\r\n\t\t\t\t\t\t\t10)) {\r\n\t\t\t\t\t\titem.msg.data[0].isFail = true;\r\n\t\t\t\t\t\titem.isFail = true;\r\n\t\t\t\t\t\tme.setData({\r\n\t\t\t\t\t\t\tchatMsg: msgList\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// if (me.curChatMsg[0].mid == curMsgMid) {\r\n\t\t\t\t//   me.curChatMsg[0].msg.data[0].isShow = false;\r\n\t\t\t\t//   me.curChatMsg[0].isShow = false;\r\n\t\t\t\t// }\r\n\r\n\t\t\t\tuni.setStorageSync(\"rendered_\" + sessionKey, msgList);\r\n\t\t\t});\r\n\t\t\tmsgStorage.on(\"newChatMsg\", this.dispMsg);\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\t\t\tnormalScroll() {\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tview: LIST_STATUS.NORMAL\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tdispMsg(renderableMsg, type, curChatMsg, sesskey) {\r\n\t\t\t\tconsole.log('renderableMsg.................................................................')\r\n\t\t\t\tconsole.log(renderableMsg)\r\n\t\t\t\tlet me = this;\r\n\t\t\t\tlet username = this.username;\r\n\t\t\t\tlet myUsername = 'jiaoyou' + uni.getStorageSync('cityUserid');\r\n\t\t\t\tlet sessionKey = username.groupId ? username.groupId + myUsername : username.your + myUsername;\r\n\t\t\t\tme.curChatMsg = curChatMsg;\r\n\r\n\t\t\t\tif (!me.__visibility__) return; // 判断是否属于当前会话\r\n\r\n\t\t\t\tif (username.groupId) {\r\n\t\t\t\t\t// 群消息的 to 是 id，from 是 name\r\n\t\t\t\t\tif (renderableMsg.info.from == username.groupId || renderableMsg.info.to == username.groupId) {\r\n\t\t\t\t\t\tif (sesskey == sessionKey) {\r\n\t\t\t\t\t\t\tme.renderMsg(renderableMsg, type, curChatMsg, sessionKey, 'newMsg');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (renderableMsg.info.from == username.your || renderableMsg.info.to == username.your) {\r\n\t\t\t\t\tif (sesskey == sessionKey) {\r\n\t\t\t\t\t\tme.renderMsg(renderableMsg, type, curChatMsg, sessionKey, 'newMsg');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tshortScroll() {\r\n\t\t\t\tthis.setData({\r\n\t\t\t\t\tview: LIST_STATUS.SHORT\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tonTap() {\r\n\t\t\t\tthis.$emit(\"msglistTap\", null, {\r\n\t\t\t\t\tbubbles: true\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tpreviewImage(event) {\r\n\t\t\t\tvar url = event.target.dataset.url;\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: [url] // 需要预览的图片 http 链接列表\r\n\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tgetHistoryMsg() {\r\n\t\t\t\tlet me = this;\r\n\t\t\t\tlet username = this.username;\r\n\t\t\t\tlet myUsername = 'jiaoyou' + uni.getStorageSync('cityUserid');\r\n\t\t\t\tlet sessionKey = username.groupId ? username.groupId + myUsername : username.your + myUsername;\r\n\t\t\t\tlet historyChatMsgs = uni.getStorageSync(\"rendered_\" + sessionKey) || [];\r\n\r\n\t\t\t\tif (Index < historyChatMsgs.length) {\r\n\t\t\t\t\tlet timesMsgList = historyChatMsgs.slice(-Index - 10, -Index);\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tchatMsg: timesMsgList.concat(me.chatMsg),\r\n\t\t\t\t\t\ttoView: timesMsgList[timesMsgList.length - 1].mid\r\n\t\t\t\t\t});\r\n\t\t\t\t\tIndex += timesMsgList.length;\r\n\r\n\t\t\t\t\tif (timesMsgList.length == 10) {\r\n\t\t\t\t\t\tpage++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('this.chatMsg..................')\r\n\t\t\t\tconsole.log(this.chatMsg)\r\n\t\t\t},\r\n\r\n\t\t\trenderMsg(renderableMsg, type, curChatMsg, sessionKey, isnew) {\r\n\t\t\t\tlet me = this;\r\n\r\n\t\t\t\tvar historyChatMsgs = uni.getStorageSync(\"rendered_\" + sessionKey) || [];\r\n\r\n\t\t\t\thistoryChatMsgs = historyChatMsgs.concat(curChatMsg);\r\n\r\n\t\t\t\tif (!historyChatMsgs.length) return;\r\n\r\n\t\t\t\tif (isnew == 'newMsg') {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tchatMsg: this.chatMsg.concat(curChatMsg),\r\n\t\t\t\t\t\t// 跳到最后一条\r\n\t\t\t\t\t\ttoView: historyChatMsgs[historyChatMsgs.length - 1].mid\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setData({\r\n\t\t\t\t\t\tchatMsg: historyChatMsgs.slice(-10),\r\n\t\t\t\t\t\t// 跳到最后一条\r\n\t\t\t\t\t\ttoView: historyChatMsgs[historyChatMsgs.length - 1].mid\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuni.setStorageSync(\"rendered_\" + sessionKey, historyChatMsgs);\r\n\t\t\t\tlet chatMsg = uni.getStorageSync(sessionKey) || [];\r\n\t\t\t\tchatMsg.map(function(item, index) {\r\n\t\t\t\t\tcurChatMsg.map(function(item2, index2) {\r\n\t\t\t\t\t\tif (item2.mid == item.mid) {\r\n\t\t\t\t\t\t\tchatMsg.splice(index, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tuni.setStorageSync(sessionKey, chatMsg);\r\n\t\t\t\tIndex = historyChatMsgs.slice(-10).length;\r\n\t\t\t\t// setTimeout 兼容支付宝小程序\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: 5000,\r\n\t\t\t\t\t\tduration: 300,\r\n\t\t\t\t\t\tfail: (e) => {\r\n\t\t\t\t\t\t\t//console.log('滚失败了', e)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 100)\r\n\r\n\t\t\t\tif (isFail) {\r\n\t\t\t\t\tthis.renderFail(sessionKey);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('this.chatMsg2222..................')\r\n\t\t\t\tconsole.log(this.chatMsg)\r\n\t\t\t},\r\n\r\n\t\t\trenderFail(sessionKey) {\r\n\t\t\t\tlet me = this;\r\n\t\t\t\tlet msgList = me.chatMsg;\r\n\t\t\t\tmsgList.map(item => {\r\n\t\t\t\t\tif (item.mid.substring(item.mid.length - 10) == curMsgMid.substring(curMsgMid.length - 10)) {\r\n\t\t\t\t\t\titem.msg.data[0].isFail = true;\r\n\t\t\t\t\t\titem.isFail = true;\r\n\t\t\t\t\t\tme.setData({\r\n\t\t\t\t\t\t\tchatMsg: msgList\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (me.curChatMsg[0].mid == curMsgMid) {\r\n\t\t\t\t\tme.curChatMsg[0].msg.data[0].isShow = false;\r\n\t\t\t\t\tme.curChatMsg[0].isShow = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuni.setStorageSync(\"rendered_\" + sessionKey, msgList);\r\n\t\t\t\tisFail = false;\r\n\t\t\t},\r\n\r\n\t\t\tclickMsg(event) {\r\n\t\t\t\tif (typeof(event.target.dataset.msg) == 'object' &&\r\n\t\t\t\t\tevent.target.dataset.msg.msg.ext &&\r\n\t\t\t\t\tevent.target.dataset.msg.msg.ext.msg_extension) {\r\n\t\t\t\t\tthis.$emit(\"clickMsg\", event.target.dataset.msg.msg.ext)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tformatMinTime(time) {\r\n\t\t\t\tif (typeof time !== 'number' || time < 0) {\r\n\t\t\t\t\treturn time\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar minute = parseInt(time / 60)\r\n\t\t\t\ttime = time % 60\r\n\t\t\t\tvar second = time\r\n\r\n\t\t\t\treturn ([minute, second]).map(function(n) {\r\n\t\t\t\t\tn = n.toString()\r\n\t\t\t\t\treturn n[1] ? n : '0' + n\r\n\t\t\t\t}).join('”')\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n<style>\r\n\t@import \"./msglist.css\";\r\n\r\n\t.rotate {\r\n\t\ttransform: rotate(180deg);\r\n\t}\r\n\r\n\t.flex-direction {\r\n\t\tflex-direction: row-reverse;\r\n\t}\r\n\r\n\t.callIcon {\r\n\t\tmargin: 0 20rpx;\r\n\t}\r\n</style>\n","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1641537566695\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}