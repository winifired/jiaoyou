{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/multiemedia/index.nvue?c205","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/multiemedia/index.nvue?c436","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/multiemedia/index.nvue?48cf","webpack:///C:/Users/Administrator/Desktop/交友(城市猎人app)/components/chat/multiemedia/index.nvue?edda","uni-app:///components/chat/multiemedia/index.nvue"],"names":[],"mappings":"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;AA8MA,eA9MA,uBA8MA,KA9MA,EA8MA;AACA;AACA,KAhNA,EAxCA;;;AA2PA,SA3PA,qBA2PA;AACA;AACA;AACA,wBADA;;AAGA;AACA;AACA,0CADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KAdA,MAcA;AACA;AACA;AACA,sBAHA,CAGA;AACA;AACA;AACA;AACA;AACA,KAFA;AAGA;AACA;AACA,KAFA;AAGA;AACA;AACA,KAFA;;AAIA;AACA;AACA,KAFA;;AAIA;AACA;AACA,KAFA;;AAIA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,mBADA;AAEA,wBAFA;AAGA,+BAHA;AAIA,oBAJA;AAKA,6BALA;;;AAQA,sCARA;AASA,6BATA;AAUA,gCAVA;AAWA,4BAXA;AAYA,0BAZA;AAaA,iBAbA;AAcA,2BAdA;AAeA,0BAfA;;AAiBA,KA1BA;;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;;AAGA,SAJA;;AAMA;AACA;;AAEA;AACA;AACA;AACA,6BADA;AAEA,uDAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAvBA;AAwBA;AACA,KA5CA;AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA;AAEA,gCAFA;AAGA;AACA;AAJA;AAMA;AACA;AACA;;AAEA;AACA,0BADA;AAEA,2BAFA;;AAIA,OAjBA;AAkBA;;AAEA,KA3BA;AA4BA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAfA;AAgBA;AACA;AACA,wBADA;;AAGA;AACA,KAvBA;AAwBA;AACA;AACA,KA1BA;;AA4BA,GAnbA,E","file":"components/chat/multiemedia/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.nvue?vue&type=template&id=a4227842&\"\nvar renderjs\nimport script from \"./index.nvue?vue&type=script&lang=js&\"\nexport * from \"./index.nvue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/chat/multiemedia/index.nvue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=template&id=a4227842&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.nvue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"wraper\">\n\t\t<view class=\"infoConnecting\">\n\t\t\t11多人会议\n\t\t</view>\n\t\t<live-pusher class=\"live-pusher\" :url=\"pubUrl\" @netstatus=\"netstatusChange\" :muted=\"false\" :enable-camera=\"true\" id=\"livePusher\"\n\t\t ref=\"livePusher\" @statechange=\"statechange\" mode=\"HD\" @error=\"error\"></live-pusher>\n\t\t</live-pusher>\n\t\n\t\t\t<view  \n\t\t\t\tv-if=\"subUrls.length > 0\"\n\t\t\t\tv-for=\"item in subUrls\">\n\t\n\t\t\t\t<video\n\t\t\t\t\t:id=\"item.streamId\"\n\t\t\t\t\t:src=\"item.subUrl\" \n\t\t\t\t\tobject-fit=\"contain\"\n\t\t\t\t\tautoplay \n\t\t\t\t>\n\t\t\t\t\t<view class=\"userName\">{{item.memName}}</view>\n\t\t\t\t</video>\n\t\n\t\t\t</view>\n\t\t<!-- </scroll-view> -->\n\t\n\t\n\t\t<!-- <view class=\"controlContent\">\n\t\t\t<view class=\"emediaContrContent\">\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleCamera\" style=\"{color: devicePositionColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+devicePositionIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t切换摄像头\n\t\t\t\t</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleMuted\" style=\"{color: micphoneColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+micphoneIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t麦克风</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"togglePlay\" style=\"{color: videoColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+videoIcon+'2x.png'\" style=\"{width:'22px'; height: '24px'}\"/>\n\t\t\t\t\t视频</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"toggleBeauty\" style=\"{color: beautyColor}\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\t:src=\"'../../../static/images/'+beautyIcon+'.png'\" style=\"{width:'16px'; height: '24px'}\"/>\n\t\t\t\t\t美颜</view>\n\t\t\t\t<view class=\"controlItem\" @tap=\"inviteMember\">\n\t\t\t\t\t<image\n\t\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\t\tsrc='../../../static/images/invite_white2x.png' style=\"{width:'22px'; height: '24px'\"/>\n\t\t\t\t\t邀请</view>\n\t\t\t</view>\n\t\n\t\t\t<view class=\"hangup\" @tap=\"hangup\">\n\t\t\t\t<image\n\t\t\t\t\tclass=\"icon-record\"\n\t\t\t\t\tsrc='../../../static/images/hangup2x.png'/>\n\t\t\t</view>\n\t\t</view>\n\t -->\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tpubUrl: \"\",\n\t\t\t\tsubUrls: [],\n\t\t\t\tshowInvite: true,\n\t\t\t\tdevicePosition: \"front\",\n\t\t\t\tmuted: false,\n\t\t\t\tplayVideoMuted: false,\n\t\t\n\t\t\t\tdevicePositionIcon: 'switchCamera_white',\n\t\t\t\tdevicePositionColor: '#fff',\n\t\t\t\tmicphoneIcon: 'micphone_white',\n\t\t\t\tbeautyIcon: 'beauty',\n\t\t\t\tmicphoneColor: '#fff',\n\t\t\t\tvideoIcon: 'video_white',\n\t\t\t\tvideoColor: '#fff',\n\t\t\t\tbeauty: 9,\n\t\t\t\tbeautyColor: '#fff',\n\t\t\t\tmyName: '',\n\t\t\t\tconfrId: '',\n\t\t\t\tenableCamera: true,\n\t\t\t\ttime: '',\n\t\t\t\tcontext: {}\n\t\t\t}\n\t\t},\n\t\tprops: {\n\t\t  username: {\n\t\t    type: Object,\n\t\t    default: () => ({}),\n\t\t  },\n\t\t  action: {\n\t\t    type: Object,\n\t\t    default: {},\n\t\t  },\n\t\t  groupId:{\n\t\t    type: String,\n\t\t    default: '',\n\t\t  },\n\t\t},\n\t\tmethods: {\n\t\t\tjoinRoom(data){\n\t\t\t\tlet me = this;\n\t\t\t\tconsole.log('joinRoom', data)\n\t\t\t\tme.context = uni.createLivePusherContext(\"livePusher\", me);\n\t\t\t\tconsole.log('我的播放组件', me.context)\n\t\t\t\tvar context = this.context\n\t\t\t\tif (context && context.ctx && context.ctx.attr && context.ctx.attr.url) {\n\t\t\t\t\tcontext.stop()\n\t\t\t\t}\n\t\t\t\tlet id = wx.WebIM.conn.getUniqueId();\n\t\t\t\tlet roomName = 'wxConfr' + id //随机的房间名，防止和别人的房间名冲突\n\t\t\t\tlet rec = wx.getStorageSync(\"rec\") || false;\n\t\t\t\tlet recMerge = wx.getStorageSync(\"recMerge\") || false;\n\t\t\t\tlet params = {\n\t\t\t\t\troomName,\n\t\t\t\t\tpassword: '',\n\t\t\t\t\trole: 7,\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\trec,\n\t\t\t\t\t\trecMerge\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (data) {\n\t\t\t\t\tparams.roomName = data.roomName\n\t\t\t\t\tparams.password = data.password\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twx.emedia.mgr.joinRoom(params).then((res) => {\n\t\t\t\t\tconsole.log('res', res)\n\t\t\t\t\tlet confrId = res.confrId\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId: confrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: confrId, groupId: me.username.groupId, roomName: params.roomName, password: params.password})\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('--------+--+----+---+--------')\n\t\t\t\t\tlet rtcId = wx.emedia.util.getRtcId()\n\t\t\t\t\tconsole.log(11111111111111, confrId)\n\t\t\t\t\twx.emedia.mgr.pubStream(rtcId).then(function(res){\n\t\t\t\t\t\tconsole.log('pubUrl-------------', res.data.rtmp)\n\t\t\t\t\t\tconsole.log(2222222222222)\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tpubUrl: res.data.rtmp\n\t\t\t\t\t\t})\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tconsole.log('55555555555', me)\n\t\t\t\t\t\t\tconsole.log(me.context)\n\t\t\t\t\t\t\tme.context.start()\n\t\t\t\t\t\t}, 500)\n\t\t\t\t\t}).catch(e => {\n\t\t\t\t\t    console.log(4444444, e)   //404\n\t\t\t\t\t    return f(false);  //即便返回了一个成功的promise,下面的finally也会执行,如果返回的是失败的promise,控制台最后一行会报错uncaught (in promise) 404\n\t\t\t\t\t})\n\t\t\t\t\t.finally( (e) => {\n\t\t\t\t\t    console.log(100,e)  //100\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log(33333333333333, me.pubUrl)\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\t\n\t\t\t},\n\t\t\tcreateConf(){\n\t\t\t\tconsole.log('>>> createConf');\n\t\t\t\t\n\t\t\t\tvar me = this\n\t\t\t\tlet rec = wx.getStorageSync(\"rec\") || false;\n\t\t\t\tlet recMerge = wx.getStorageSync(\"recMerge\") || false;\n\t\t\t\t//参数：会议类型 密码 是否录制 是否合并\n\t\t\t\twx.emedia.mgr.createConference(10, '', rec, recMerge).then(function(data){\n\t\t\t\t\tconsole.log('成功', data)\n\t\t\t\t\tlet ticket = data.data.ticket\n\t\t\t\t\tlet ticketJosn = JSON.parse(ticket)\n\t\t\t\t\tlet confrId = ticketJosn.confrId\n\t\n\t\t\t\t\twx.emedia.mgr.joinConferenceWithTicket(confrId, ticket).then(function(res){\n\t\t\t\t\t\tconsole.log('加入会议成功', res)\n\t\t\t\t\t})\n\t\t\t\t\t// wx.emedia.mgr.joinConference(confrId, '').then(function(res){\n\t\t\t\t\t// \tconsole.log('加入会议成功', res)\n\t\t\t\t\t// })\n\t\t\t\t\t\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: confrId, groupId: me.username.groupId})\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\tjoinConf(data){\n\t\t\t\tconsole.log('加入会议 ————-------————')\n\t\t\t\tconsole.log(data)\n\t\t\t\tlet me = this\n\t\t\t\twx.emedia.mgr.getConferenceTkt(data.confrId, data.password).then(function(res){\n\t\t\t\t\tconsole.log('申请reqTkt成功', res.data)\n\t\t\t\t\tlet ticket = res.data.ticket || ''\n\t\t\t\t\tlet tktObj = JSON.parse(ticket)\n\t\t\t\t\twx.emedia.mgr.joinConferenceWithTicket(data.confrId, ticket).then(function(res){\n\t\t\t\t\t\tconsole.log('加入会议成功', res)\n\t\t\t\t\t})\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tconfrId: tktObj.confrId\n\t\t\t\t\t})\n\t\t\t\t\tme.$emit('createConfrSuccess', {confrId: tktObj.confrId, groupId: me.username.groupId})\n\t\t\t\t})\n\t\t\t},\n\t\t\t\n\t\t\ttogglePlay(){\n\t\t\t\tlet me = this\n\t\t\t\tconsole.log(\"%c togglePlay\", \"color:green\")\n\t\n\t\t\t\t// this.LivePusherContext.stop()\n\t\t\t\tthis.setData({\n\t\t\t\t\tenableCamera: !me.enableCamera,\n\t\t\t\t\tpubUrl: me.pubUrl,\n\t\t\t\t\tvideoIcon: this.videoIcon == 'video_white'?'video_gray': 'video_white',\n\t\t\t\t\tvideoColor: this.videoColor == '#fff'? '#aaa': '#fff'\n\t\t\t\t}, () => {\n\t\t\t\t\tthis.LivePusherContext.start()\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\ttoggleCamera(){\n\t\t\t\tconsole.log(\"%c toggleCamera\", \"color:green\")\n\t\t\t\tlet me = this\n\t\t\t\t// me.LivePusherContext.stop()\n\t\t\t\tme.LivePusherContext.switchCamera({\n\t\t\t\t\tsuccess: function(){\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tdevicePosition: me.devicePosition == 'fron' ? 'back' : 'front',\n\t\t\t\t\t\t\tdevicePositionIcon: me.devicePositionIcon =='switchCamera_white'?'switchCamera_gray': 'switchCamera_white',\n\t\t\t\t\t\t\tdevicePositionColor: me.devicePositionColor == '#fff'? '#aaa':'#fff'\n\t\t\t\t\t\t}, () => {\n\t\t\t\t\t\t\t// me.LivePusherContext.start()\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t},\n\t\n\t\t\ttoggleMuted(){\n\t\t\t\tconsole.log(\"%c toggleMuted\", \"color:green\")\n\t\t\t\tthis.setData({\n\t\t\t\t\tmuted: !this.muted,\n\t\t\t\t\tmicphoneIcon: this.micphoneIcon == 'micphone_white'? 'micphone_gray': 'micphone_white',\n\t\t\t\t\tmicphoneColor: this.micphoneColor == '#fff'? '#aaa': '#fff'\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\ttoggleBeauty(){\n\t\t\t\tthis.setData({\n\t\t\t\t\tbeauty: this.beauty == 0 ? 9 : 0,\n\t\t\t\t\tbeautyColor: this.beautyColor == '#fff'? '#aaa': '#fff',\n\t\t\t\t\tbeautyIcon: this.beautyIcon == 'beauty' ? 'beauty_gray': 'beauty'\n\t\t\t\t})\n\t\t\t},\n\t\n\t\t\thangup(){\n\t\t\t\tconsole.log('挂断', this.confrId)\n\t\t\t\twx.emedia.mgr.exitConference(this.confrId)\n\t\t\t\tthis.$emit('hangup')\n\t\t\t\tthis.stopTimer()\n\t\t\t},\n\t\t\tinviteMember(){\n\t\t\t\tthis.$emit('inviteMember', this.groupId)\n\t\t\t},\n\t\t\t// statechange(e){\n\t\t\t// \tconsole.log('>>>>>>>>>live-pusher code:', e.detail)\n\t\t\t// \tif (e.detail.code === 5001) {\n\t\t\t// \t\t// 部分安卓手机在接电话时会停止推拉流报错，状态码5001，此时退出会议。 https://developers.weixin.qq.com/community/develop/doc/0006ac6d7a4968fa675a49fef53c00\n\t\t\t// \t\tthis.hangup()\n\t\t\t// \t\tconsole.error('由于有电话接入，已退出会议')\n\t\t\t// \t}\n\t\t\t// },\n\t\t\tnetstatusChange(e){\n\t\t\t\tconsole.log('>>>>>>>>>>net status:', e.detail)\n\t\t\t},\n\t\n\t\t\tgetTimer(){\n\t\t\t\tlet count = 0;\n\t\t\t\tlet time = '00:00:00'\n\t\t\t\tthis.timer = setInterval(() => {\n\t\t\t\t\tcount++;\n\t\t\t\t\tlet s = showNum(count % 60);\n\t\t\t\t\tlet m = showNum(parseInt((count / 60)) % 60)\n\t\t\t\t\tlet h = showNum(parseInt(count / 60 / 60))\n\t\t\t\t\ttime = `${h}:${m}:${s}`\n\t\t\t\t\tthis.setData({\n\t\t\t\t\t\ttime\n\t\t\t\t\t})\n\t\t\t\t}, 1000)\n\t\n\t\t\t\tfunction showNum(num) {\n\t\t\t\t\tif (num < 10) {\n\t\t\t\t\t\treturn '0' + num\n\t\t\t\t\t}\n\t\t\t\t\treturn num\n\t\t\t\t}\n\t\n\t\t\t},\n\t\t\tstopTimer(){\n\t\t\t\tclearInterval(this.timer)\n\t\t\t},\n\t\t\terror(err){\n\t\t\t\tconsole.log('EEEEEEEEEEEEE', err)\n\t\t\t},\n\t\t\tstatechange(state){\n\t\t\t\tconsole.log(\"SSSSSSSSSSS\", state)\n\t\t\t}\n\t\t},\n\t\t\n\t\tmounted() {\n\t\t\tconsole.log('进入')\n\t\t\twx.setKeepScreenOn({\n\t\t\t  keepScreenOn: true\n\t\t\t})\n\t\t\tconsole.log('进入111')\n\t\t\tthis.setData({\n\t\t\t\tmyName: wx.WebIM.conn.context.userId\n\t\t\t})\n\t\t\tconsole.log('进入222')\n\t\t\tthis.getTimer()\n\t\t\tvar me = this\n\t\t\tlet subUrls = []\n\t\t\tlet obj = {};\n\t\t\tconsole.log('进入333')\n\t\t\tthis.LivePusherContext = uni.createLivePusherContext('livePusher',this)\n\t\t\tconsole.log('this.LivePusherContext ..', this.LivePusherContext)\n\t\t\tif(this.action&&this.action.action == 'join'){\n\t\t\t\tconsole.log('join')\n\t\t\t\t// 音视频sdk提供两种创建、加入会议的api 使用任意一种都可以：（1） 一种是通过会议id ticket 或者 会议id 密码加入会议 如使用下面 joinConf\n\t\t\t\t// （2）另一种是通过房间名 密码加入 如使用下面joinRoom\n\n\t\t\t\t//this.joinConf(this.action) // （1）\n\t\t\t\t//this.joinRoom(this.action) // （2）\n\t\t\t\tif (this.action.roomName) {\n\t\t\t\t\tconsole.log('使用joinroom')\n\t\t\t\t\tthis.joinRoom(this.action)\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('使用joinConf')\n\t\t\t\t\tthis.joinConf(this.action)\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\t// 创建会议同样是两种api （1）一种是使用createConf 单纯创建一个会议，需要再申请ticket 或者用密码加入会议 如使用下面的createConf\n\t\t\t\t// （2）也可以使用joinRoom，通过房间名、密码创建房间并直接加入 不需再进行加入会议的操作\n\t\t\t\tthis.joinRoom() // （1）\n\t\t\t\t//this.createConf() // （2）\n\t\t\t}\n\t\t\twx.emedia.mgr.onMediaChanaged = function(e){\n\t\t\t\tconsole.log('onMediaChanaged', e)\n\t\t\t}\n\t\t\twx.emedia.mgr.onConferenceExit = function(e){\n\t\t\t\tconsole.log('onConferenceExit', e)\n\t\t\t}\n\t\t\twx.emedia.mgr.onMemberExited = function(reason){\n\t\t\t\tconsole.log('onMemberExited', reason)\n\t\t\t};\n \n\t\t\twx.emedia.mgr.onStreamControl = function(mem){\n\t\t\t\tconsole.log('onStreamControl', mem)\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onStreamControl.onSoundChanage = function(a, b, c, d){\n\t\t\t\tconsole.log('onSoundChanage')\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onReconnect = function (res, ent){\n\t\t\t\t// 发生断网重连，相当于重新加入会议\n\n\t\t\t\t// 清空live-player 否则在原来的后面追加，导致原来的黑屏显示\n\t\t\t\tsubUrls = []\n\n\t\t\t\t// 重新加入恢复到初始状态，防止和控制按钮状态不符\n\n\t\t\t\t// 重连后摄像头方向不会改变\n\t\t\t\tme.setData({\n\t\t\t\t\tsubUrls: [],\n\t\t\t\t\tshowInvite: true,\n\t\t\t\t\tdevicePosition: \"front\",\n\t\t\t\t\tmuted: false,\n\t\t\t\t\tplayVideoMuted: false,\n\n\t\t\t\t\t\n\t\t\t\t\tmicphoneIcon: 'micphone_white',\n\t\t\t\t\tmicphoneColor: '#fff',\n\t\t\t\t\tvideoIcon: 'video_white',\n\t\t\t\t\tbeautyIcon: 'beauty',\n\t\t\t\t\tvideoColor: '#fff',\n\t\t\t\t\tbeauty: 9,\n\t\t\t\t\tbeautyColor: '#fff',\n\t\t\t\t\tenableCamera: true\n\t\t\t\t})\n\t\t\t}\n\n\t\t\twx.emedia.mgr.onMemberJoined = function(mem){\n\t\t\t\tconsole.log(\"++++++++++ member\", mem)\n\t\t\t\tvar jid = wx.WebIM.conn.context.jid\n\t\t\t\tlet identityName = jid.appKey + '_' + jid.name+ '@' + jid.domain\n\t\t\t\t// let identityName = wx.WebIM.conn.context.jid.split(\"/\")[0]\n\t\t\t\t// 如果是自己进入会议了，开始发布流\n\t\t\t\tif(mem.name == identityName){\n\t\t\t\t\tlet rtcId = wx.emedia.util.getRtcId()\n\t\t\t\t\twx.emedia.mgr.pubStream(rtcId).then(function(res){\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tpubUrl: res.data.rtmp\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tvar enableCamera = me.enableCamera;\n\t\t\t\t\tconsole.warn(\"begin enable camera\", me.enableCamera);\n\n\t\t\t\t\t//默认enableCamera为false  关闭摄像头时声音不会有延迟，否则有延迟\n\t\t\t\t\t//所以最好别用autopush\n\t\t\t\t\tme.setData({\n\t\t\t\t\t\tenableCamera: false,\n\t\t\t\t\t\tpubUrl: me.url + 'record_type=audio' || 'https://domain/push_stream',\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\t// var enableCameraDefault = true\n\t\t\t\t\t\t//if(!enableCameraDefault){ //治疗不推流的毛病\n\t\t\t\t\t\t\t// console.log('关闭摄像头推流')\n\t\t\t\t\t\t\t// setTimeout(() => {\n\t\t\t\t\t\t\t// \tme.LivePusherContext.start({\n\t\t\t\t\t\t\t// \t\tsuccess: function () {\n\t\t\t\t\t\t\t\t\t\t// console.log('关闭摄像头推流', enableCamera)\n\t\t\t\t\t\t\t\t\t\tenableCamera && me.setData({enableCamera: enableCamera})\n\t\t\t\t\t\t\t// \t\t}\n\t\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t\t// }, 1500)\n\t\t\t\t\t\t// }else{\n\t\t\t\t\t\t// \tme.LivePusherContext.start({\n\t\t\t\t\t\t   //  \tsuccess: function () {\n\t\t\t\t\t\t   //  \t\tconsole.log('开始推流了', enableCamera)\n\t\t\t\t\t\t   //    \t\tenableCamera && me.setData({enableCamera: enableCamera})\n\t\t\t\t\t\t   //  \t}\n\t\t\t\t\t\t   //  })\n\t\t\t\t\t\t// }\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\twx.emedia.mgr.onStreamAdded = function(stream){\n\t\t\t\tconsole.log('%c onAddStream', 'color: green', stream)\n\t\t\t\tlet streamId = stream.id\n\t\t\t\t// setTimeout(() => {\n\t\t\t\t\tif(subUrls.length > 8){\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\twx.emedia.mgr.subStream(streamId).then(function(data){\n\t\t\t\t\t\tconsole.log('%c 订阅流成功', 'color:green', data)\n\t\t\t\t\t\t// let playContext = wx.createLivePlayerContext(streamId, me)\n\t\t\t\t\t\tlet subUrl = {\n\t\t\t\t\t\t\tstreamId: streamId,\n\t\t\t\t\t\t\tsubUrl: data.data.rtmp,\n\t\t\t\t\t\t\tmemName: stream.memName.split(\"_\")[1].split(\"@\")[0],\n\t\t\t\t\t\t\t// playContext: playContext\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsubUrls.push(subUrl)\n\t\t\t\t\t\tconsole.log('%c subUrls 11 ....', \"background:yellow\")\n\t\t\t\t\t\tconsole.log(subUrls)\n\t\n\t\t\t\t\t\tme.setData({\n\t\t\t\t\t\t\tsubUrls: subUrls,\n\t\t\t\t\t\t\tshowInvite: false\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t// }, 2000)\n\n\t\t\t}\n\t\t\twx.emedia.mgr.onStreamRemoved = function(stream){\n\t\t\t\tconsole.log('%c onRemoveStream', 'color: red', stream)\n\t\t\t\tsubUrls = subUrls.filter((item) => {\n\t\t\t\t\tif(item.streamId != stream.id){\n\t\t\t\t\t\treturn item\n\t\t\t\t\t}else{\n\t\t\t\t\t\tconsole.log('%c ------', 'backgroukd:yellow')\n\t\t\t\t\t\tconsole.log(item)\n\t\t\t\t\t\t// item.playContext.stop({\n\t\t\t\t\t\t// \tsuccess: function(){\n\t\t\t\t\t\t// \t\tconsole.log('关闭成功')\n\t\t\t\t\t\t// \t},\n\t\t\t\t\t\t// \tcomplete: function(){\n\t\t\t\t\t\t// \t\tconsole.log('关闭成功')\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// })\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tobj[stream.id] = false\n\t\t\t\tme.setData({\n\t\t\t\t\tsubUrls: subUrls,\n\t\t\t\t})\n\t\t\t\tconsole.log('subUrls', subUrls)\n\t\t\t},\n\t\t\twx.emedia.mgr.onConfrAttrsUpdated = function(e){\n\t\t\t\tconsole.log('onConfrAttrsUpdated: ', e)\n\t\t\t}\n\t\t\t\n\t\t},\n\t\n\t}\n</script>\n\n\n"],"sourceRoot":""}